<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>UrbanFabric</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252" />
<meta name="viewport" content="initial-scale=0.5, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<link href='http://fonts.googleapis.com/css?family=Josefin+Sans+Std+Light' rel='stylesheet' type='text/css'/>
<script src="/static/jquery.js" type="text/javascript"> </script>
<script src="/static/bnhash.js" type="text/javascript"> </script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<style type="text/css">
body {
	margin: 0 0 0 0;
	background-color: transparent;
}
#ufmap {
	top:0;
	right:0;
	position:absolute;
}
 #header: {
 top:0px;
 width:100%;
 height:150px;
}
#header-decoration {
	z-index:1000;
	width:100%;
	position:absolute;
	top:75px;
	height:25px;
	left:0;
	background-color:orange;
}
#header-image {
	z-index:1100;
	width:150px;
	height:150px;
	top:5px;
	left:5px;
	position:absolute;
	background-image: url('/static/imgs/UF_flat.png');
	background-repeat: no-repeat;
}
#header-text {
	z-index:1100;
	left:180px;
	top:39px;
	position:absolute;
	font-size:60px;
	font-family:'Josefin Sans Std Light', Calibri, Verdana, Helvetica, sans-serif;
	text-shadow:2px 2px 8px #000;
}
#header-menu {
	z-index:1100;
	right:0px;
	top:78px;
	width:140 px;
	height:50px;
	position:absolute;
}
#left-container {
	background-color:ffb;
	left:0px;
	position:absolute;
	top:0px;
	width:500px;
	z-index:990;
	-webkit-box-shadow: 3px 0px 2px #888;
	box-shadow: 3px 0px 2px #888;
}
#content {
	top:170px;
	left:15px;
	position:absolute;
	width:470px;
	background-color:white;
	overflow:auto;
}
#header-menu {
	font-family:'Josefin Sans Std Light', Calibri, Verdana, Helvetica, sans-serif;
}
.menu-item {
	display:inline-block;
	width:24px;
	height:24px;
}
#menu-login {
	background-image:url('/static/icons/user.png');
}
#menu-position {
	background-image:url('/static/icons/where.png');
}
#menu-add-venue {
	background-image:url('/static/icons/add.png');
}
#menu-add-venue-group {
	background-image:url('/static/icons/add.png');
}
</style>
</head>
<body>
<div id="ufmap"></div>
<div id="header">
        <div id="header-decoration"></div>
        <div id="header-image"></div>
        <div id="header-text">UrbanFabric<span id="collection-name"></span></div>
        <div id="header-menu">
                <div id="menu-login" class="menu-item" title="Login">
                        <div id="popup">
                                <div><span id="get_login">Login</span>| <span id="get_signup">Sign up</span></div>
                                <div id="lilo-form-container"></div>
                        </div>
                </div>
                <div id="menu-position" class="menu-item" title="Where am i?"> </div>
                <div id="menu-add-venue" class="loggedin menu-item" title="Add Venue"> </div>
                <div id="menu-add-venue-group" class="loggedin menu-item" title="Add Venue Collection"> </div>
        </div>
</div>
<div id="left-container">
        <div id="content"> <span class="text"> </span> </div>
</div>
<div id="searchbox"></div>
<script>



resize = function (sidebar) {
	var diff = 0;
	if (sidebar)
		diff = $('#left-container').width();
	$('#ufmap').width($(window).width()-diff);
    	$('#ufmap').height($(window).height());
    	$('#left-container').height($(window).height());
	$('#content').height($(window).height()-180);
	$('#ufmap').css('left', diff)
}

refreshmap = function(collection){
	var default_mapstyle = [
	{
		featureType: "transit",
    		elementType: "all",
    		stylers: [
      			{ saturation: 98 },
      			{ hue: "#ff8c00" }
    		]
  	},{
    		featureType: "road",
    		elementType: "all",
    		stylers: [
      			{ hue: "#ff8c00" }
    		]
  	},{
    		featureType: "landscape.man_made",
    		elementType: "all",
    		stylers: [
      			{ saturation: 99 },
      			{ hue: "#ff8c00 " },
      			{ lightness: 1 },
      			{ visibility: "simplified" }
    		]
  	},{
    		featureType: "poi.business",
    		elementType: "all",
    		stylers: [
      			{ saturation: 0 },
      			{ lightness: 28 }
    		]
  	},{
    		featureType: "all",
    		elementType: "all",
    		stylers: [
      			{ saturation: 100 },
      			{ lightness: 10 },
      			{ gamma: 0.94 }
    		]
  	}];
	
	if(collection){
		$.getJSON('collection/'+collection+'/mapstyle', function(data){
			run_refresh(data);
		});
		}
	else 
		run_refresh(default_mapstyle);
	}
	
run_refresh = function(mapstyle){
	
    	var myOptions = {
		zoom:16,
		mapTypeControlOptions: {
       			mapTypeIds: [google.maps.MapTypeId.SATELLITE, google.maps.MapTypeId.HYBRID, 'UF']
    		},
		mapTypeControl:true,
		mapTypeControlOptions: {
			style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
			position:google.maps.ControlPosition.TOP
        	},
		navigationControl:true,
		navigationControlOptions: {
			style:google.maps.NavigationControlStyle.SMALL,
			position:google.maps.ControlPosition.BOTTOM
        	},
    	};
	
    	jQuery.ufmap = new google.maps.Map(document.getElementById("ufmap"), myOptions);
	
	jQuery.styledMapOptions = {
		name: "UF"
	}

	var jayzMapType = new google.maps.StyledMapType(mapstyle, jQuery.styledMapOptions);

	jQuery.ufmap.mapTypes.set('UF', jayzMapType);
	jQuery.ufmap.setMapTypeId('UF');
	}

change_hash = function(hash){
	if  (hash == undefined) {
		$('#left-container').show();
		jQuery.sidebar = true;
		resize(	jQuery.sidebar);
		refreshmap();
	} else{
		$('#left-container').hide();
		jQuery.sidebar = false;
		list 	= hash.split("/");
		count = list.length;
		if (count >0)
			var collection = list[0];
		if (jQuery.old_collection != collection){
			jQuery.old_collection = collection;
			var collection_url = '/collection/'+collection;
			$.getJSON(collection_url, function(data){
				console.debug(data);
				$('#collection-name').text(": " + data[0].fields.name);
			});
			$.getJSON(collection_url+"/contents", function(data){
				for (el in data){
					render_marker(data[el]);
				}
			});
		}
		if (count >1)
		var item = list[1];
		//get item data and display it
	}
	
		resize(	jQuery.sidebar);
		refreshmap(collection);

}

render_marker = function(element){
	console.debug('rendering element')
	console.debug(element)
	var myLatLng = new google.maps.LatLng(element.latitude, element.longitude);
	var marker = new google.maps.Marker({
      		position: myLatLng, 
      		map: jQuery.ufmap, 
      		title:"Hello World!"
  	});   
}

jQuery.ufmap = null;
localize = function(position) {
    	initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
    	jQuery.ufmap.setCenter(initialLocation);
}
$(function() {
	
	$("#menu-login").click(function(e) {
		e.preventDefault();
                $("fieldset#signin_menu").toggle();
                $("menu-login").toggleClass("menu-open");
	});
	
	refreshmap();
	$('#popup').hide();
	$('#left-container').hide();
	jQuery.sidebar = false;
	resize(	jQuery.sidebar);
	change_hash(window.location.hash.split('#')[1]);
	$(window).resize(function(){resize(jQuery.sidebar)});
    	
	if (navigator.geolocation) {
        jQuery.watcher = navigator.geolocation.watchPosition(localize, handleNoGeolocation);
    } else {
        handleNoGeolocation();
    }

    function handleNoGeolocation() {

    }
jQuery.old_collection = "";
    $( window.location ).bind("change",
function(e, d){
change_hash(d.currentHash);
});
                          });
</script>
</body>
</html>
